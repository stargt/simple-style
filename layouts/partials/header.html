<header>
  {{ with .Site.Menus.parent -}}
  <nav>
    {{ range . -}}
    <a href="{{ .URL }}">{{ .Name }}</a>
    {{ end -}}
  </nav>
  {{ end -}}
  <div>
    <h1><a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a></h1>
    {{- if .Site.Params.subtitle }}
    <h2><a href="{{ .Site.BaseURL }}">{{ .Site.Params.subtitle }}</a></h2>
    {{- end }}
  </div>
  <nav>
    {{- range .Site.Menus.main -}}
    <a href="{{ .URL }}">{{ .Name }}</a>
    {{- end -}}
    <a
      href="javascript:void(0);"
      id="subscribe-opener"
      onclick="openSubscribeForm()"
      >Subscribe</a
    >
    {{ partial "search.html" . }}
  </nav>
  <form id="subscribeForm">
    <input name="email" type="email" placeholder="Type your Email" />
    <input type="submit" value="Subscribe" />
  </form>
</header>

<script>
  function openSubscribeForm() {
    subscribeForm.style.display = 'flex';
    document.getElementById('subscribe-opener').style.fontWeight = 'bold';
    subscribeForm.email.focus();
  }

  subscribeForm.addEventListener('submit', async (event) => {
    event.preventDefault();

    const form = event.target;
    const email = form.email.value;

    try {
      const response = await fetch('/subscribe', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ email }),
      });

      if (response.ok || true) {
        alert(
          `A confirmation email has been sent to [${email}]!\nPlease check your inbox.`
        );
        form.reset();
        form.style.display = 'none';
        document.getElementById('subscribe-opener').style.fontWeight = 'normal';
      } else {
        alert('Failed to subscribe. Please try again.');
      }
    } catch (error) {
      alert('Failed to subscribe. Please try again.');
    }
  });
</script>
